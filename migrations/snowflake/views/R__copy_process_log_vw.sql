create or replace view COM.COPY_PROCESS_LOG_VW(
	EXECUTION_ID,
	ETL_NAME,
	ETL_TASK_NAME,
	EXECUTED_SP,
	EXECUTION_STATUS,
	QUERY_ID,
	QUERY_TYPE,
	SP_START_TIME,
	START_TIME,
	SP_END_TIME,
	END_TIME,
	SOURCE,
	SOURCE_ROWS,
	DESTINATION,
	ROWS_LOADED,
	ROWS_INSERTED,
	ROWS_UPDATED,
	FILE_NAME,
	LOAD_STATUS,
	TOTAL_ELAPSED_TIME,
	ERRORS_SEEN,
	FIRST_ERROR,
	FIRST_ERROR_CHARACTER,
	FIRST_ERROR_COLUMN_NAME,
	FIRST_ERROR_LINE,
	FAIL_CODE,
	ERROR_MESSAGE,
	STACK_TRACE,
	ERROR_STATE,
	USER_NAME,
	LOAD_DATE,
	UPLOADED_DATE
) as
SELECT
    EXECUTION_ID,
    ETL_NAME,
    ETL_TASK_NAME,
    EXECUTED_SP,
    DTLS_AFTER_EXEC.VALUE :EXECUTION_STATUS :: VARCHAR AS EXECUTION_STATUS,
    DTLS_AFTER_EXEC.VALUE :QUERY_ID :: VARCHAR AS QUERY_ID,
    DTLS_AFTER_EXEC.VALUE :QUERY_TYPE :: VARCHAR AS QUERY_TYPE,
    START_TIME AS SP_START_TIME,
    DTLS_AFTER_EXEC.VALUE :START_TIME :: DATETIME AS START_TIME,
    END_TIME AS SP_END_TIME,
    DTLS_AFTER_EXEC.VALUE :END_TIME :: DATETIME AS END_TIME,
    DTLS_AFTER_EXEC.VALUE :SOURCE :: VARCHAR AS SOURCE,
    DTLS_AFTER_EXEC.VALUE :SOURCE_ROWS :: VARCHAR AS SOURCE_ROWS,
    DTLS_AFTER_EXEC.VALUE :DESTINATION :: VARCHAR AS DESTINATION,
    DTLS_AFTER_EXEC.VALUE :ROWS_LOADED :: NUMBER AS ROWS_LOADED,
    DTLS_AFTER_EXEC.VALUE :ROWS_INSERTED :: NUMBER AS ROWS_INSERTED,
    DTLS_AFTER_EXEC.VALUE :ROWS_UPDATED :: NUMBER AS ROWS_UPDATED,
    DTLS_AFTER_EXEC.VALUE :FILE_NAME :: VARCHAR AS FILE_NAME,
    DTLS_AFTER_EXEC.VALUE :LOAD_STATUS :: VARCHAR AS LOAD_STATUS,
    DTLS_AFTER_EXEC.VALUE :TOTAL_ELAPSED_TIME :: VARCHAR AS TOTAL_ELAPSED_TIME,
    DTLS_AFTER_EXEC.VALUE :ERRORS_SEEN :: NUMBER AS ERRORS_SEEN,
    DTLS_AFTER_EXEC.VALUE :LOAD_ERROR :: VARCHAR AS FIRST_ERROR,
    DTLS_AFTER_EXEC.VALUE :LOAD_ERROR_CHARACTER :: VARCHAR AS FIRST_ERROR_CHARACTER,
    DTLS_AFTER_EXEC.VALUE :LOAD_ERROR_COLUMN_NAME :: VARCHAR AS FIRST_ERROR_COLUMN_NAME,
    DTLS_AFTER_EXEC.VALUE :LOAD_ERROR_LINE :: VARCHAR AS FIRST_ERROR_LINE,
    DTLS_AFTER_EXEC.VALUE :FAIL_CODE :: VARCHAR AS FAIL_CODE,
    DTLS_AFTER_EXEC.VALUE :MESSAGE :: VARCHAR AS ERROR_MESSAGE,
    DTLS_AFTER_EXEC.VALUE :STACK_TRACE :: VARCHAR AS STACK_TRACE,
    DTLS_AFTER_EXEC.VALUE :STATE :: VARCHAR AS ERROR_STATE,
    DTLS_AFTER_EXEC.VALUE :USER_NAME :: VARCHAR AS USER_NAME,
	DTLS_AFTER_EXEC.VALUE :LOAD_DATE :: VARCHAR AS LOAD_DATE,
	DTLS_AFTER_EXEC.VALUE :UPLOADED_DATE :: VARCHAR AS UPLOADED_DATE
FROM
    COM.PROCESS_AUDIT_LOG LOG,
    TABLE(FLATTEN(LOG.DETAILS_AFTER_EXEC)) DTLS_AFTER_EXEC
WHERE
    EXECUTED_SP = 'COM.GENERIC_LOAD_STG_TABLE_SP'
	OR
	EXECUTED_SP = 'COM.GENERIC_LOAD_STG_TABLE_CASE_SENSITIVE_SP'
ORDER BY
    START_TIME DESC;